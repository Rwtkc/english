<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>è‹±è¯­ç»¼åˆæµ‹è¯•ç³»ç»Ÿ</title>
    <style>
      :root {
        --primary: #4a90e2;
        --success: #2ecc71;
        --error: #e74c3c;
        --bg: #f5f7fa;
      }
      body {
        font-family: "Segoe UI", "Microsoft YaHei", sans-serif;
        background: var(--bg);
        margin: 0;
        padding: 20px 20px 350px 20px;
        color: #2c3e50;
        line-height: 1.8;
      }
      .container {
        max-width: 800px;
        margin: 0 auto;
      }
      header {
        text-align: center;
        margin-bottom: 20px;
        background: white;
        padding: 20px;
        border-radius: 12px;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
      }
      .tabs {
        display: flex;
        justify-content: center;
        gap: 10px;
        margin-bottom: 25px;
        flex-wrap: wrap;
      }
      .tab-btn {
        padding: 8px 20px;
        background: #e0e7ff;
        color: var(--primary);
        border: none;
        border-radius: 25px;
        font-weight: bold;
        cursor: pointer;
        transition: 0.3s;
        margin-bottom: 5px;
      }
      .tab-btn.active {
        background: var(--primary);
        color: white;
      }
      .module {
        display: none;
      }
      .module.active-module {
        display: block;
        animation: fadeIn 0.4s;
      }
      @keyframes fadeIn {
        from {
          opacity: 0;
          transform: translateY(10px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      /* é€šç”¨ç»„ä»¶ */
      .stats-bar {
        position: sticky;
        top: 10px;
        z-index: 100;
        background: rgba(255, 255, 255, 0.95);
        backdrop-filter: blur(10px);
        padding: 12px 20px;
        border-radius: 50px;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 25px;
        border: 1px solid rgba(0, 0, 0, 0.05);
      }
      .action-btn {
        padding: 8px 20px;
        background: var(--primary);
        color: white;
        border: none;
        border-radius: 20px;
        cursor: pointer;
      }

      /* æ¨¡å—1 (å•é€‰) */
      .question-card {
        background: white;
        border-radius: 12px;
        padding: 20px;
        margin-bottom: 20px;
        border-left: 5px solid var(--primary);
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.06);
      }
      .options-grid {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 15px;
        margin-top: 15px;
      }
      .option-btn {
        padding: 12px;
        border: 2px solid #eef2f7;
        border-radius: 8px;
        background: white;
        cursor: pointer;
        text-align: left;
        transition: 0.2s;
      }
      .option-btn.correct {
        background: var(--success);
        color: white;
        border-color: var(--success);
      }
      .option-btn.wrong {
        background: var(--error);
        color: white;
        border-color: var(--error);
      }

      /* æ¨¡å—2 & 3 (å¡«ç©º) */
      .sentence-card {
        background: white;
        padding: 25px;
        border-radius: 12px;
        margin-bottom: 20px;
        font-size: 1.1rem;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.06);
      }
      .blank {
        display: inline-block;
        padding: 0 8px;
        border-bottom: 2px solid #bdc3c7;
        cursor: pointer;
        text-align: center;
        border-radius: 4px 4px 0 0;
        margin: 0 2px;
      }
      .blank.original {
        color: #95a5a6;
        background: #f8f9fa;
        border-bottom-style: dashed;
      }
      .blank.original:hover {
        background: #e9ecef;
        border-color: var(--primary);
        color: #333;
      }
      .blank.filled {
        color: var(--primary);
        font-weight: bold;
        border-bottom: 2px solid var(--primary);
        background: rgba(74, 144, 226, 0.1);
      }
      .blank.correct {
        color: white;
        background: var(--success);
        border-color: var(--success);
        border-bottom: none;
      }
      .blank.wrong {
        color: white;
        background: var(--error);
        border-color: var(--error);
        border-bottom: none;
        text-decoration: line-through;
      }
      .correction {
        color: var(--success);
        font-weight: bold;
        margin-left: 8px;
        font-size: 0.9em;
      }

      /* å•è¯åº“ */
      .word-bank {
        position: fixed;
        bottom: 0;
        left: 0;
        width: 100%;
        background: white;
        box-shadow: 0 -4px 20px rgba(0, 0, 0, 0.1);
        padding: 20px 20px 40px;
        z-index: 500;
        display: none;
        flex-direction: column;
        align-items: center;
        box-sizing: border-box;
        transition: opacity 0.3s;
      }
      .word-bank.disabled {
        opacity: 0.8;
        pointer-events: none;
        filter: grayscale(0.5);
      }
      .word-pool {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(110px, 1fr));
        gap: 10px;
        width: 100%;
        max-width: 800px;
        margin-top: 10px;
      }
      .word-chip {
        height: 55px;
        background: #f0f2f5;
        border: 1px solid #d1d5db;
        border-radius: 8px;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        text-align: center;
        font-weight: 500;
        user-select: none;
        transition: 0.15s;
        padding: 0 5px;
        font-size: 0.9rem;
      }
      .word-chip:hover {
        background: #e2e8f0;
        transform: translateY(-2px);
      }
      .word-chip.used {
        opacity: 0.3;
        pointer-events: none;
        background: #e5e7eb;
        border-style: dashed;
      }

      /* å¼¹çª— */
      #result-modal {
        display: none;
        position: fixed;
        inset: 0;
        background: rgba(0, 0, 0, 0.6);
        justify-content: center;
        align-items: center;
        z-index: 1000;
        backdrop-filter: blur(5px);
      }
      .modal-content {
        background: white;
        padding: 30px;
        border-radius: 15px;
        text-align: center;
        width: 90%;
        max-width: 400px;
        animation: popIn 0.3s;
      }
      @keyframes popIn {
        from {
          transform: scale(0.8);
          opacity: 0;
        }
        to {
          transform: scale(1);
          opacity: 1;
        }
      }
      /* æ¨¡å—4 (å¤ä¹ å¡ç‰‡) */
      .review-card {
        background: white;
        border-radius: 12px;
        padding: 25px;
        margin-bottom: 20px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.06);
        border-left: 5px solid #9b59b6; /* ç´«è‰²ä¸»é¢˜ */
      }
      .review-title {
        color: #7f8c8d;
        font-size: 0.9em;
        margin-bottom: 5px;
        font-weight: bold;
        text-transform: uppercase;
        letter-spacing: 1px;
      }
      .original-text {
        font-size: 1.1em;
        color: #34495e;
        margin-bottom: 15px;
        padding-bottom: 15px;
        border-bottom: 1px dashed #eee;
      }
      .revised-text {
        font-size: 1.2em;
        color: #2c3e50;
        background: #fdf2ff; /* æµ…ç´«è‰²èƒŒæ™¯å¼ºè°ƒ */
        padding: 15px;
        border-radius: 8px;
        border: 1px solid #e1bee7;
      }
      .revised-text strong {
        color: #8e44ad;
        background: rgba(142, 68, 173, 0.1);
        padding: 0 4px;
        border-radius: 4px;
        border-bottom: 2px solid #8e44ad;
      }
      .note-text {
        margin-top: 10px;
        font-size: 0.9em;
        color: #7f8c8d;
        font-style: italic;
      }
      reveal-mask {
        background: #f8f9fa;
        border: 2px dashed #bdc3c7;
        border-radius: 8px;
        padding: 25px;
        text-align: center;
        cursor: pointer;
        color: #7f8c8d;
        font-weight: bold;
        transition: all 0.2s;
        margin-top: 15px;
      }
      .reveal-mask:hover {
        background: #eef2f7;
        color: var(--primary);
        border-color: var(--primary);
        transform: translateY(-2px);
      }
      .answer-section {
        display: none; /* é»˜è®¤éšè— */
        animation: fadeIn 0.4s ease-out;
      }
      /* æ¨¡å—7 (é˜…è¯») æ ·å¼ */
      .unit-header {
        background: #34495e;
        color: white;
        padding: 10px 20px;
        border-radius: 8px;
        margin: 30px 0 15px 0;
        font-size: 1.2em;
        font-weight: bold;
      }
      .reading-card {
        background: white;
        border-radius: 12px;
        padding: 20px;
        margin-bottom: 20px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
      }
      .reading-question {
        font-weight: bold;
        margin-bottom: 15px;
        color: #2c3e50;
      }
      .reading-opt-btn {
        display: block;
        width: 100%;
        text-align: left;
        padding: 10px 15px;
        margin-bottom: 8px;
        border: 1px solid #e0e0e0;
        border-radius: 6px;
        background: white;
        cursor: pointer;
        transition: all 0.2s;
        font-size: 0.95em;
      }
      .reading-opt-btn:hover:not(.disabled) {
        background: #f8f9fa;
        border-color: var(--primary);
      }
      .reading-opt-btn.correct {
        background: #d4edda;
        border-color: #28a745;
        color: #155724;
      }
      .reading-opt-btn.wrong {
        background: #f8d7da;
        border-color: #dc3545;
        color: #721c24;
      }
      /* === æ¨¡å—8 (æ®µè½åŒ¹é…) - ä¼˜åŒ–ç‰ˆ === */
      .match-container {
        display: flex;
        gap: 20px; /* å·¦å³ä¸¤åˆ—çš„é—´è· */
        align-items: flex-start;
      }
      .match-column {
        flex: 1; /* å·¦å³ä¸¤åˆ—ç­‰å®½ (50% : 50%) */
        display: flex;
        flex-direction: column;
        gap: 15px; /* ä¸Šä¸‹å¡ç‰‡çš„é—´è· */
        min-width: 0; /* é˜²æ­¢flexå­é¡¹è¢«é•¿æ–‡æœ¬æ’‘å¼€ */
      }
      .match-title {
        text-align: center;
        font-weight: bold;
        color: var(--primary);
        margin-bottom: 15px;
        font-size: 1.1em;
        background: #eef2f7;
        padding: 10px;
        border-radius: 8px;
      }
      .match-item {
        background: white;
        border: 2px solid #e0e0e0;
        border-radius: 10px;
        padding: 15px;
        cursor: pointer;
        transition: all 0.2s;
        font-size: 0.95em;
        position: relative;

        /* å…³é”®ä¿®æ”¹ï¼šå›ºå®šé«˜åº¦å’Œå®½åº¦é€»è¾‘ */
        height: 220px; /* å¼ºåˆ¶å›ºå®šé«˜åº¦ï¼Œè§†è§‰æ•´é½ */
        width: 100%; /* å æ»¡åˆ—å®½ */
        box-sizing: border-box;

        /* å†…å®¹å¸ƒå±€ */
        display: flex;
        flex-direction: column;
        justify-content: center; /*æ–‡å­—å‚ç›´å±…ä¸­*/
        overflow-y: auto; /* æ–‡å­—è¿‡å¤šæ—¶æ˜¾ç¤ºæ»šåŠ¨æ¡ */
      }

      /* ç¾åŒ–æ»šåŠ¨æ¡ (Chrome/Safari) */
      .match-item::-webkit-scrollbar {
        width: 6px;
      }
      .match-item::-webkit-scrollbar-thumb {
        background-color: #bdc3c7;
        border-radius: 3px;
      }

      .match-item:hover {
        border-color: #bdc3c7;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
        transform: translateY(-2px);
      }

      /* é€‰ä¸­çŠ¶æ€ */
      .match-item.selected {
        border-color: var(--primary);
        background: rgba(74, 144, 226, 0.1);
        box-shadow: 0 0 0 3px rgba(74, 144, 226, 0.2);
        z-index: 10;
      }

      /* åŒ¹é…æˆåŠŸ */
      .match-item.matched {
        border-color: var(--success);
        background: #d4edda;
        color: #155724;
        cursor: default;
        opacity: 0.7; /* ç¨å¾®å˜æ·¡ï¼Œçªå‡ºæœªå®Œæˆçš„é¡¹ */
        transform: none;
        box-shadow: none;
      }

      /* åŒ¹é…é”™è¯¯åŠ¨ç”» */
      .match-item.error {
        animation: shake 0.4s;
        border-color: var(--error);
        background: #f8d7da;
      }
      @keyframes shake {
        0%,
        100% {
          transform: translateX(0);
        }
        25% {
          transform: translateX(-5px);
        }
        75% {
          transform: translateX(5px);
        }
      }
      /* === ğŸ“± æ‰‹æœºç«¯é€‚é…ä¼˜åŒ– (è§£å†³åº•éƒ¨é®æŒ¡é—®é¢˜) === */
      @media (max-width: 768px) {
        /* 1. é™åˆ¶åº•éƒ¨è¯åº“çš„æœ€å¤§é«˜åº¦ */
        .word-bank {
          max-height: 30vh; /* å¼ºåˆ¶é™åˆ¶é«˜åº¦ä¸è¶…è¿‡å±å¹•çš„ 40% */
          overflow-y: auto; /* å¦‚æœå•è¯å¤ªå¤šï¼Œè¯åº“å†…éƒ¨æ»šåŠ¨ï¼Œè€Œä¸æ˜¯è®©å®ƒæ— é™é•¿ */
          padding: 10px 10px 20px 10px; /* å‡å°‘å†…è¾¹è· */
          box-shadow: 0 -2px 10px rgba(0, 0, 0, 0.1); /* é˜´å½±æ”¹å°ä¸€ç‚¹ */
        }

        /* 2. ç¼©å°å•è¯å—ï¼Œè®©ä¸€è¡Œèƒ½æ”¾ä¸‹æ›´å¤š */
        .word-pool {
          /* æœ€å°å®½åº¦ä» 110px æ”¹ä¸º 80px */
          grid-template-columns: repeat(auto-fill, minmax(80px, 1fr));
          gap: 6px; /* é—´è·å˜å° */
          margin-top: 5px;
        }

        .word-chip {
          height: 40px; /* é«˜åº¦ä» 55px å‡å°åˆ° 40px */
          font-size: 0.85rem; /* å­—ä½“æ”¹å° */
          border-radius: 6px;
        }

        /* 3. è°ƒæ•´æ­£æ–‡åº•éƒ¨ç•™ç™½ï¼Œç¡®ä¿èƒ½æ»šåŠ¨åˆ°æœ€åä¸€è¡Œ */
        body {
          /* ç•™ç™½è¦å¤§äºè¯åº“çš„æœ€å¤§é«˜åº¦ (40vh) */
          padding-bottom: 45vh !important;
          padding-top: 10px;
          padding-left: 10px;
          padding-right: 10px;
        }

        /* 4. ä¼˜åŒ–é¡¶éƒ¨ Tab æŒ‰é’®ï¼Œé˜²æ­¢æ¢è¡Œå¤ªä¹± */
        .tab-btn {
          padding: 6px 12px;
          font-size: 0.9em;
          margin-bottom: 4px;
        }

        /* 5. å¡«ç©ºé¢˜çš„ç©ºæ ¼ä¹Ÿç¨å¾®ç¼©å°ä¸€ç‚¹ */
        .sentence-card {
          padding: 15px;
          font-size: 1rem;
        }
      }
    </style>
  </head>
  <body>
    <div class="container">
      <header><h1>ğŸ“– è‹±è¯­ç»¼åˆæµ‹è¯•</h1></header>
      <div class="tabs">
        <button class="tab-btn active" onclick="switchTab('module-1')">
          è¯æ±‡
        </button>
        <button class="tab-btn" onclick="switchTab('module-2')">
          åŒä¹‰æ›¿æ¢1
        </button>
        <button class="tab-btn" onclick="switchTab('module-3')">
          åŒä¹‰æ›¿æ¢2
        </button>
        <button class="tab-btn" onclick="switchTab('module-4')">
          æ¨¡ç³Šè¯­å¤ä¹ 
        </button>
        <button class="tab-btn" onclick="switchTab('module-5')">
          å¥å­è¿‘ä¹‰è½¬æ¢
        </button>
        <button class="tab-btn" onclick="switchTab('module-6')">åè¯åŒ–</button>
        <button class="tab-btn" onclick="switchTab('module-7')">é˜…è¯»</button>
        <button class="tab-btn" onclick="switchTab('module-8')">
          æ®µè½åŒ¹é…
        </button>
      </div>

      <!-- æ¨¡å—1 -->
      <div id="module-1" class="module active-module">
        <div class="stats-bar">
          <span>ğŸ“ è¿›åº¦: <span id="m1-progress">-- / --</span></span>
          <button class="action-btn" onclick="renderModule1()">ğŸ”„ é‡ç½®</button>
          <span>ğŸ† å¾—åˆ†: <span id="m1-score">0</span></span>
        </div>
        <div id="m1-area"></div>
      </div>

      <!-- æ¨¡å—2 -->
      <div id="module-2" class="module">
        <div class="stats-bar">
          <span>ğŸ“ é¢˜ç›®: 5 / 10 (éšæœº)</span>
          <button class="action-btn" onclick="initModule2()">ğŸ”„ æ¢ä¸€æ‰¹</button>
        </div>
        <div id="m2-area"></div>
        <div style="text-align: center">
          <button id="m2-submit" class="action-btn" onclick="checkModule2()">
            âœ… æäº¤ç­”æ¡ˆ
          </button>
        </div>
      </div>

      <!-- æ¨¡å—3 (æ–°å¢) -->
      <div id="module-3" class="module">
        <div class="stats-bar">
          <span>ğŸ“ é¢˜ç›®: TASK 3 å…¨é¢˜</span>
          <button class="action-btn" onclick="initModule3()">ğŸ”„ é‡ç½®</button>
        </div>
        <div id="m3-area"></div>
        <div style="text-align: center">
          <button id="m3-submit" class="action-btn" onclick="checkModule3()">
            âœ… æäº¤ç­”æ¡ˆ
          </button>
        </div>
      </div>
      <div id="module-4" class="module">
        <div class="stats-bar" style="justify-content: center">
          <span>ğŸ“š é‡ç‚¹å¤ä¹ ï¼šP216 æ¨¡ç³Šè¯­æ”¹å†™ (Read Only)</span>
        </div>
        <div id="m4-area"></div>
      </div>
      <div id="module-5" class="module">
        <div class="stats-bar" style="justify-content: center">
          <span>ğŸ” é‡ç‚¹å¤ä¹ ï¼šP217 å¥å¼å‡çº§ (Read Only)</span>
        </div>
        <div id="m5-area"></div>
      </div>
      <div id="module-6" class="module">
        <div class="stats-bar" style="justify-content: center">
          <span>ğŸ·ï¸ é‡ç‚¹å¤ä¹ ï¼šP173 åè¯åŒ– (Read Only)</span>
        </div>
        <div id="m6-area"></div>
      </div>
      <div id="module-7" class="module">
        <div class="stats-bar">
          <span>ğŸ“š Unit 1, 2, 4, 6 (å…± 40 é¢˜)</span>
          <button class="action-btn" onclick="renderModule7()">
            ğŸ”„ é‡ç½®çŠ¶æ€
          </button>
        </div>
        <div id="m7-area"></div>
      </div>
      <div id="module-8" class="module">
        <div class="stats-bar">
          <span>ğŸ§© Unit 2: åŒ¹é…æ®µè½å¤§æ„ (25 Pairs)</span>
          <button class="action-btn" onclick="renderModule8()">ğŸ”„ é‡ç½®</button>
        </div>
        <div class="match-container">
          <div class="match-column" id="m8-left-col">
            <div class="match-title">Paragraphs (Text)</div>
            <div id="m8-texts"></div>
          </div>
          <div class="match-column" id="m8-right-col">
            <div class="match-title">Main Ideas (Options)</div>
            <div id="m8-options"></div>
          </div>
        </div>
      </div>
    </div>

    <!-- åº•éƒ¨ -->
    <div id="word-bank" class="word-bank">
      <div
        style="
          color: #7f8c8d;
          width: 100%;
          max-width: 800px;
          display: flex;
          justify-content: space-between;
        "
      >
        <span id="bank-msg">ç‚¹å‡»å•è¯æ›¿æ¢ç°è‰²åŸè¯</span
        ><span id="bank-count"></span>
      </div>
      <div id="word-pool" class="word-pool"></div>
    </div>

    <!-- å¼¹çª— -->
    <div id="result-modal">
      <div class="modal-content">
        <h2>ğŸ‰ æµ‹è¯•å®Œæˆ!</h2>
        <div
          style="
            font-size: 3em;
            color: #4a90e2;
            font-weight: bold;
            margin: 10px 0;
          "
          id="modal-score"
        >
          0
        </div>
        <button
          class="action-btn"
          onclick="document.getElementById('result-modal').style.display='none'"
        >
          ğŸ” æŸ¥çœ‹ç»“æœ
        </button>
      </div>
    </div>

    <!-- å¼•å…¥å¤–éƒ¨æ•°æ®æ–‡ä»¶ -->
    <script src="data.js"></script>

    <script>
      let db = QUIZ_DATABASE;
      let state = {
        m1: { score: 0, answered: 0 },
        m2: { sentences: [], userAnswers: {}, bank: [] },
        m3: { sentences: [], userAnswers: {}, bank: [] },
        m4: { loaded: false },
        m5: { loaded: false },
        m6: { loaded: false },
        m7: { loaded: false },
        m8: { loaded: false, selectedLeft: null, matchedCount: 0 },
      };
      let currentModuleId = "module-1"; // è¿½è¸ªå½“å‰æ¿€æ´»çš„æ¨¡å—

      // åˆå§‹åŒ–
      renderModule1();

      // --- Tab åˆ‡æ¢ ---
      function switchTab(id) {
        currentModuleId = id;
        document
          .querySelectorAll(".tab-btn")
          .forEach((b) => b.classList.remove("active"));
        event.target.classList.add("active");
        document
          .querySelectorAll(".module")
          .forEach((m) => m.classList.remove("active-module"));
        document.getElementById(id).classList.add("active-module");

        const bank = document.getElementById("word-bank");

        if (id === "module-2") {
          bank.style.display = "flex";
          if (state.m2.sentences.length === 0 && db.sentenceData.length > 0)
            initModule2();
          else renderModule2(); // é‡æ–°æ¸²æŸ“ä»¥æ¢å¤è¯åº“çŠ¶æ€
        } else if (id === "module-3") {
          bank.style.display = "flex";
          if (state.m3.sentences.length === 0 && db.task3Data.length > 0)
            initModule3();
          else renderModule3();
        } else if (id === "module-4") {
          bank.style.display = "none"; // ä¸éœ€è¦è¯åº“
          if (!state.m4.loaded) renderModule4();
        } else if (id === "module-5") {
          bank.style.display = "none";
          if (!state.m5.loaded) renderModule5();
        } else if (id === "module-6") {
          bank.style.display = "none";
          if (!state.m6.loaded) renderModule6();
        } else if (id === "module-7") {
          bank.style.display = "none";
          renderModule7(); // æ¯æ¬¡åˆ‡æ¢æ£€æŸ¥ï¼Œæˆ–è€…åªåœ¨æœªåŠ è½½æ—¶åŠ è½½
        } else if (id === "module-8") {
          bank.style.display = "none";
          if (!state.m8.loaded) renderModule8();
        } else {
          bank.style.display = "none";
        }
      }

      // --- æ¨¡å—1 é€»è¾‘ ---
      function renderModule1() {
        if (!db.quizData1.length) return;
        state.m1 = { score: 0, answered: 0 };
        updateM1Stats();
        const area = document.getElementById("m1-area");
        area.innerHTML = "";

        db.quizData1.forEach((q, i) => {
          const card = document.createElement("div");
          card.className = "question-card";
          card.innerHTML = `<div style="font-weight:bold; margin-bottom:10px;">${q.id}. ${q.word}</div>`;
          const grid = document.createElement("div");
          grid.className = "options-grid";

          ["A", "B"].forEach((label, idx) => {
            const btn = document.createElement("button");
            btn.className = "option-btn";
            btn.textContent = `${label}. ${q.options[idx]}`;
            btn.onclick = () => {
              if (btn.classList.contains("disabled")) return;
              grid.querySelectorAll(".option-btn").forEach((b) => {
                b.classList.add("disabled");
                b.style.cursor = "default";
              });
              if (idx === q.answer) {
                btn.classList.add("correct");
                state.m1.score++;
              } else {
                btn.classList.add("wrong");
                grid.children[q.answer].classList.add("correct");
              }
              state.m1.answered++;
              updateM1Stats();
              if (state.m1.answered === db.quizData1.length)
                showResult(`å•é€‰å¾—åˆ†: ${state.m1.score} / 80`);
            };
            grid.appendChild(btn);
          });
          card.appendChild(grid);
          area.appendChild(card);
        });
      }

      function updateM1Stats() {
        document.getElementById("m1-score").textContent = state.m1.score;
        document.getElementById(
          "m1-progress"
        ).textContent = `${state.m1.answered} / ${db.quizData1.length}`;
      }

      // --- æ¨¡å—2 é€»è¾‘ (éšæœº5é¢˜) ---
      function initModule2() {
        if (!db.sentenceData.length) return;
        document.getElementById("word-bank").classList.remove("disabled");
        document.getElementById("bank-msg").textContent =
          "ç‚¹å‡»å•è¯æ›¿æ¢ç°è‰²åŸè¯";

        const shuffled = [...db.sentenceData].sort(() => 0.5 - Math.random());
        state.m2.sentences = shuffled.slice(0, 5);
        state.m2.userAnswers = {};

        let words = [];
        state.m2.sentences.forEach((s) => words.push(...s.answers));
        shuffled.slice(5).forEach((s) => words.push(...s.answers));
        state.m2.bank = words.sort(() => 0.5 - Math.random());

        renderModule2();
      }

      function renderModule2() {
        const area = document.getElementById("m2-area");
        area.innerHTML = "";
        document.getElementById("m2-submit").style.display = "inline-block";

        state.m2.sentences.forEach((q, qIdx) => {
          let html = q.text;
          q.answers.forEach((_, aIdx) => {
            const key = `${qIdx}_${aIdx}`;
            const val = state.m2.userAnswers[key];
            const cls = val ? "filled" : "original";
            const txt = val || q.origin[aIdx];
            html = html.replace(
              `{${aIdx}}`,
              `<span class="blank ${cls}" onclick="handleBlank('m2', '${key}')">${txt}</span>`
            );
          });
          const card = document.createElement("div");
          card.className = "sentence-card";
          card.innerHTML = `${qIdx + 1}. ${html}`;
          area.appendChild(card);
        });
        renderBank("m2");
      }

      function checkModule2() {
        let correct = 0,
          total = 0;
        document.getElementById("m2-submit").style.display = "none";
        document.getElementById("word-bank").classList.add("disabled");
        document.getElementById("bank-msg").textContent = "æµ‹è¯•ç»“æŸ (å­˜æ¡£)";

        const area = document.getElementById("m2-area");
        area.innerHTML = "";
        state.m2.sentences.forEach((q, qIdx) => {
          let html = q.text;
          q.answers.forEach((ans, aIdx) => {
            total++;
            const key = `${qIdx}_${aIdx}`;
            const val = state.m2.userAnswers[key];
            let spanHtml = "";
            if (val === ans) {
              correct++;
              spanHtml = `<span class="blank correct">${val}</span>`;
            } else {
              spanHtml = `<span class="blank wrong">${
                val || q.origin[aIdx]
              }</span><span class="correction">(${ans})</span>`;
            }
            html = html.replace(`{${aIdx}}`, spanHtml);
          });
          const card = document.createElement("div");
          card.className = "sentence-card";
          card.innerHTML = `${qIdx + 1}. ${html}`;
          area.appendChild(card);
        });
        showResult(`å¾—åˆ†: ${correct} / ${total}`);
      }

      // --- æ¨¡å—3 é€»è¾‘ (TASK 3 - P178) ---
      // --- å‡çº§ç‰ˆ initModule3 (æ”¯æŒå¤šé€‰ä¸€) ---
      function initModule3() {
        if (!db.task3Data.length) return;
        document.getElementById("word-bank").classList.remove("disabled");
        document.getElementById("bank-msg").textContent =
          "ç‚¹å‡»å•è¯æ›¿æ¢ç°è‰²åŸè¯";

        state.m3.sentences = [...db.task3Data];
        state.m3.userAnswers = {};

        let words = [];
        state.m3.sentences.forEach((s) => {
          s.answers.forEach((ans) => {
            // å…³é”®ä¿®æ”¹ï¼šå¦‚æœæ˜¯æ•°ç»„ï¼ˆå¤šé€‰ä¸€ï¼‰ï¼Œå°±æŠŠé‡Œé¢çš„è¯éƒ½åŠ è¿›è¯åº“
            if (Array.isArray(ans)) {
              words.push(...ans);
            } else {
              words.push(ans);
            }
          });
        });

        // æ·»åŠ å¹²æ‰°é¡¹
        words.push("attempt", "underline");
        // æ³¨æ„ï¼šä¸è¦å†æ‰‹åŠ¨åŠ  "generates" æˆ– "yields" äº†ï¼Œä¸Šé¢ä»£ç å·²ç»è‡ªåŠ¨åŠ è¿›å»äº†

        state.m3.bank = words.sort(() => 0.5 - Math.random());
        renderModule3();
      }

      function renderModule3() {
        const area = document.getElementById("m3-area");
        area.innerHTML = "";
        document.getElementById("m3-submit").style.display = "inline-block";

        state.m3.sentences.forEach((q, qIdx) => {
          let html = q.text;
          q.answers.forEach((_, aIdx) => {
            const key = `${qIdx}_${aIdx}`;
            const val = state.m3.userAnswers[key];
            const cls = val ? "filled" : "original";
            const txt = val || q.origin[aIdx];
            html = html.replace(
              `{${aIdx}}`,
              `<span class="blank ${cls}" onclick="handleBlank('m3', '${key}')">${txt}</span>`
            );
          });
          const card = document.createElement("div");
          card.className = "sentence-card";
          card.innerHTML = `${qIdx + 1}. ${html}`;
          area.appendChild(card);
        });
        renderBank("m3");
      }

      // --- å‡çº§ç‰ˆ checkModule3 (æ”¯æŒå¤šé€‰ä¸€) ---
      function checkModule3() {
        let correct = 0,
          total = 0;
        document.getElementById("m3-submit").style.display = "none";
        document.getElementById("word-bank").classList.add("disabled");
        document.getElementById("bank-msg").textContent = "æµ‹è¯•ç»“æŸ (å­˜æ¡£)";

        const area = document.getElementById("m3-area");
        area.innerHTML = "";

        state.m3.sentences.forEach((q, qIdx) => {
          let html = q.text;
          q.answers.forEach((ans, aIdx) => {
            total++;
            const key = `${qIdx}_${aIdx}`;
            const val = state.m3.userAnswers[key];
            let spanHtml = "";

            // å…³é”®ä¿®æ”¹ï¼šåˆ¤æ–­é€»è¾‘æ”¯æŒæ•°ç»„
            let isCorrect = false;
            let correctText = ""; // ç”¨äºæ˜¾ç¤ºæ­£ç¡®ç­”æ¡ˆæ–‡æœ¬

            if (Array.isArray(ans)) {
              // å¦‚æœç­”æ¡ˆæ˜¯æ•°ç»„ï¼Œåªè¦ç”¨æˆ·å¡«çš„è¯åœ¨æ•°ç»„é‡Œå°±ç®—å¯¹
              isCorrect = ans.includes(val);
              correctText = ans.join(" / "); // æ˜¾ç¤ºç­”æ¡ˆæ—¶æ˜¾ç¤º "generates / yields"
            } else {
              // æ™®é€šå•é€‰
              isCorrect = val === ans;
              correctText = ans;
            }

            if (isCorrect) {
              correct++;
              spanHtml = `<span class="blank correct">${val}</span>`;
            } else {
              spanHtml = `<span class="blank wrong">${
                val || q.origin[aIdx]
              }</span><span class="correction">(${correctText})</span>`;
            }

            html = html.replace(`{${aIdx}}`, spanHtml);
          });

          const card = document.createElement("div");
          card.className = "sentence-card";
          card.innerHTML = `${qIdx + 1}. ${html}`;
          area.appendChild(card);
        });

        showResult(`å¾—åˆ†: ${correct} / ${total}`);
      }

      // --- é€šç”¨ï¼šæ¸²æŸ“è¯åº“ ---
      function renderBank(moduleKey) {
        const pool = document.getElementById("word-pool");
        pool.innerHTML = "";
        const currentState = state[moduleKey];

        const used = Object.values(currentState.userAnswers);
        const usedCounts = {};
        used.forEach((w) => (usedCounts[w] = (usedCounts[w] || 0) + 1));

        currentState.bank.forEach((word) => {
          const chip = document.createElement("div");
          chip.className = "word-chip";
          chip.textContent = word;
          if (usedCounts[word] > 0) {
            chip.classList.add("used");
            usedCounts[word]--;
          } else {
            chip.onclick = () => fillBlank(moduleKey, word);
          }
          pool.appendChild(chip);
        });
        document.getElementById("bank-count").textContent = `å‰©ä½™: ${
          currentState.bank.length - used.length
        }`;
      }

      // --- é€šç”¨ï¼šå¡«ç©º ---
      function fillBlank(moduleKey, word) {
        if (document.getElementById("word-bank").classList.contains("disabled"))
          return;
        const currentState = state[moduleKey];
        // æ‰¾ç¬¬ä¸€ä¸ªç©ºä½
        for (let i = 0; i < currentState.sentences.length; i++) {
          for (let j = 0; j < currentState.sentences[i].answers.length; j++) {
            const key = `${i}_${j}`;
            if (!currentState.userAnswers[key]) {
              currentState.userAnswers[key] = word;
              if (moduleKey === "m2") renderModule2();
              if (moduleKey === "m3") renderModule3();
              return;
            }
          }
        }
      }

      // --- é€šç”¨ï¼šæ’¤é”€ ---
      function handleBlank(moduleKey, key) {
        if (document.getElementById("word-bank").classList.contains("disabled"))
          return;
        const currentState = state[moduleKey];
        if (currentState.userAnswers[key]) {
          delete currentState.userAnswers[key];
          if (moduleKey === "m2") renderModule2();
          if (moduleKey === "m3") renderModule3();
        }
      }

      function showResult(msg) {
        document.getElementById("modal-score").textContent = msg;
        document.getElementById("result-modal").style.display = "flex";
      }
      // --- æ¨¡å—4 é€»è¾‘ (å¤ä¹ æ¨¡å¼) ---
      // --- æ¨¡å—4 é€»è¾‘ (å¤ä¹ æ¨¡å¼ - ç‚¹å‡»æ˜¾ç¤º) ---
      function renderModule4() {
        if (!db.hedgeData) return;
        const area = document.getElementById("m4-area");
        area.innerHTML = "";

        db.hedgeData.forEach((item, index) => {
          const card = document.createElement("div");
          card.className = "review-card";
          // ä½¿ç”¨å”¯ä¸€IDæ¥æ§åˆ¶æ¯ä¸ªå¡ç‰‡çš„æ˜¾ç¤º
          const answerId = `m4-ans-${index}`;
          const maskId = `m4-mask-${index}`;

          card.innerHTML = `
            <div class="review-title">Original Sentence</div>
            <div class="original-text">${item.original}</div>
            
            <div id="${maskId}" class="reveal-mask" onclick="toggleAnswer('${index}')">
              ğŸ‘ï¸ ç‚¹å‡»æŸ¥çœ‹æ¨¡ç³Šè¯­æ”¹å†™ (Click to Reveal)
            </div>

            <div id="${answerId}" class="answer-section">
              <div class="review-title" style="color:#9b59b6; margin-top:15px;">Fuzzy / Hedged Version</div>
              <div class="revised-text">${item.revised}</div>
              <div class="note-text">ğŸ’¡ ${item.desc}</div>
            </div>
          `;
          area.appendChild(card);
        });
        state.m4.loaded = true;
      }

      // åˆ‡æ¢æ˜¾ç¤ºçŠ¶æ€çš„å‡½æ•°
      function toggleAnswer(index) {
        const mask = document.getElementById(`m4-mask-${index}`);
        const answer = document.getElementById(`m4-ans-${index}`);

        if (mask && answer) {
          mask.style.display = "none"; // éšè—æŒ‰é’®
          answer.style.display = "block"; // æ˜¾ç¤ºç­”æ¡ˆ
        }
      }
      // --- æ¨¡å—5 é€»è¾‘ (è¿‘ä¹‰è½¬æ¢) ---
      function renderModule5() {
        if (!db.paraphraseData) return;
        const area = document.getElementById("m5-area");
        area.innerHTML = "";

        db.paraphraseData.forEach((item, index) => {
          const card = document.createElement("div");
          card.className = "review-card";
          // è¿™é‡Œçš„æ ·å¼ç›´æ¥å¤ç”¨ Module 4 çš„ css
          card.style.borderLeftColor = "#e67e22"; // æ¢ä¸ªé¢œè‰²åŒºåˆ†(æ©™è‰²)

          const maskId = `m5-mask-${index}`;
          const answerId = `m5-ans-${index}`;

          card.innerHTML = `
            <div class="review-title">Original Sentence</div>
            <div class="original-text">${item.original}</div>
            
            <div id="${maskId}" class="reveal-mask" onclick="toggleM5('${index}')">
              ğŸ” ç‚¹å‡»æŸ¥çœ‹å‡çº§å¥å¼ (Click to Reveal)
            </div>

            <div id="${answerId}" class="answer-section">
              <div class="review-title" style="color:#e67e22; margin-top:15px;">Paraphrased / Upgraded Version</div>
              <div class="revised-text" style="background:#fff8e1; border-color:#ffe082;">
                ${item.revised}
              </div>
              <div class="note-text">ğŸ’¡ ${item.desc}</div>
            </div>
          `;
          area.appendChild(card);
        });
        state.m5.loaded = true;
      }

      function toggleM5(index) {
        document.getElementById(`m5-mask-${index}`).style.display = "none";
        document.getElementById(`m5-ans-${index}`).style.display = "block";
      }
      // --- æ¨¡å—6 é€»è¾‘ (åè¯åŒ–) ---
      function renderModule6() {
        if (!db.nominalData) return;
        const area = document.getElementById("m6-area");
        area.innerHTML = "";

        db.nominalData.forEach((item, index) => {
          const card = document.createElement("div");
          card.className = "review-card";
          // æ ·å¼å¾®è°ƒï¼šä½¿ç”¨æ·±é’è‰²ä¸»é¢˜
          card.style.borderLeftColor = "#16a085";

          const maskId = `m6-mask-${index}`;
          const answerId = `m6-ans-${index}`;

          card.innerHTML = `
            <div class="review-title">Original Sentence</div>
            <div class="original-text">${item.original}</div>
            
            <div id="${maskId}" class="reveal-mask" onclick="toggleM6('${index}')">
              ğŸ·ï¸ ç‚¹å‡»æŸ¥çœ‹åè¯åŒ–æ”¹å†™ (Click to Reveal)
            </div>

            <div id="${answerId}" class="answer-section">
              <div class="review-title" style="color:#16a085; margin-top:15px;">Nominalized Version</div>
              <div class="revised-text" style="background:#e8f8f5; border-color:#a2d9ce;">
                ${item.revised}
              </div>
              <div class="note-text">ğŸ’¡ ${item.desc}</div>
            </div>
          `;
          // ä¿®æ­£å†…éƒ¨ strong æ ‡ç­¾çš„é¢œè‰²ï¼Œä½¿å…¶åŒ¹é…ä¸»é¢˜
          const strongTags = card.querySelectorAll(".revised-text strong");
          strongTags.forEach((tag) => {
            tag.style.color = "#16a085";
            tag.style.background = "rgba(22, 160, 133, 0.1)";
            tag.style.borderBottomColor = "#16a085";
          });

          area.appendChild(card);
        });
        state.m6.loaded = true;
      }

      function toggleM6(index) {
        document.getElementById(`m6-mask-${index}`).style.display = "none";
        document.getElementById(`m6-ans-${index}`).style.display = "block";
      }
      // --- æ¨¡å—7 é€»è¾‘ (é˜…è¯») ---
      function renderModule7() {
        if (!db.readingData) return;
        const area = document.getElementById("m7-area");
        area.innerHTML = "";

        let currentUnit = "";

        db.readingData.forEach((q, index) => {
          // æ’å…¥å•å…ƒæ ‡é¢˜
          if (q.unit !== currentUnit) {
            currentUnit = q.unit;
            const header = document.createElement("div");
            header.className = "unit-header";
            header.textContent = currentUnit;
            area.appendChild(header);
          }

          const card = document.createElement("div");
          card.className = "reading-card";

          // é¢˜ç›®æ–‡å­—
          const qText = document.createElement("div");
          qText.className = "reading-question";
          qText.textContent = `${q.id}. ${q.question}`;
          card.appendChild(qText);

          // é€‰é¡¹åŒºåŸŸ
          const optContainer = document.createElement("div");
          q.options.forEach((opt, optIdx) => {
            const btn = document.createElement("button");
            btn.className = "reading-opt-btn";
            // é€‰é¡¹æ ‡ç­¾ A/B/C/D
            const label = String.fromCharCode(65 + optIdx);
            btn.textContent = `${label}. ${opt}`;

            btn.onclick = function () {
              // é”å®šè¯¥é¢˜æ‰€æœ‰æŒ‰é’®
              const allBtns = optContainer.querySelectorAll(".reading-opt-btn");
              allBtns.forEach((b) => {
                b.classList.add("disabled");
                b.onclick = null; // ç§»é™¤ç‚¹å‡»äº‹ä»¶
                b.style.cursor = "default";
              });

              if (optIdx === q.answer) {
                btn.classList.add("correct");
              } else {
                btn.classList.add("wrong");
                // é«˜äº®æ­£ç¡®ç­”æ¡ˆ
                allBtns[q.answer].classList.add("correct");
              }
            };
            optContainer.appendChild(btn);
          });

          card.appendChild(optContainer);
          area.appendChild(card);
        });
        state.m7.loaded = true;
      }
      // --- æ¨¡å—8 é€»è¾‘ (å¤šå•å…ƒæ®µè½åŒ¹é…) ---
      function renderModule8(unitName = "Unit 2") {
        if (!db.matchData) return;

        // 1. ç¡®ä¿é¡¶éƒ¨æŒ‰é’®ç»„å­˜åœ¨ä¸”çŠ¶æ€æ­£ç¡®
        const statsBar = document.querySelector("#module-8 .stats-bar");
        let btnGroup = document.getElementById("m8-unit-selector");

        if (!btnGroup) {
          // å¦‚æœæŒ‰é’®ç»„ä¸å­˜åœ¨ï¼Œåˆ›å»ºå®ƒ
          statsBar.innerHTML = ""; // æ¸…ç©ºåŸæœ‰å†…å®¹

          btnGroup = document.createElement("div");
          btnGroup.id = "m8-unit-selector";
          btnGroup.style.display = "flex";
          btnGroup.style.gap = "8px";
          btnGroup.style.flexWrap = "wrap"; // é˜²æ­¢çª„å±æ¢è¡Œä¹±æ‰

          // å®šä¹‰æœ‰çš„å•å…ƒ
          const units = ["Unit 2", "Unit 3", "Unit 4", "Unit 5"];

          units.forEach((u) => {
            const btn = document.createElement("button");
            btn.className = "action-btn";
            btn.style.padding = "4px 12px";
            btn.style.fontSize = "0.85em";
            btn.textContent = u;
            // ç»‘å®šç‚¹å‡»äº‹ä»¶
            btn.onclick = () => renderModule8(u);
            btnGroup.appendChild(btn);
          });

          statsBar.appendChild(btnGroup);

          // æ·»åŠ é‡ç½®æŒ‰é’®
          const resetBtn = document.createElement("button");
          resetBtn.className = "action-btn";
          resetBtn.style.marginLeft = "auto"; // é å³
          resetBtn.style.background = "#e67e22"; // æ©™è‰²åŒºåˆ†
          resetBtn.textContent = "ğŸ”„ é‡ç½®";
          resetBtn.onclick = () => renderModule8(unitName);
          statsBar.appendChild(resetBtn);
        }

        // æ›´æ–°æŒ‰é’®é«˜äº®çŠ¶æ€
        Array.from(btnGroup.children).forEach((btn) => {
          if (btn.textContent === unitName) {
            btn.style.background = "#2980b9"; // æ·±è“é«˜äº®
            btn.style.opacity = "1";
          } else {
            btn.style.background = "#95a5a6"; // ç°è‰²éé«˜äº®
            btn.style.opacity = "0.7";
          }
        });

        // 2. ç­›é€‰æ•°æ®
        const unitData = db.matchData.filter((item) => item.unit === unitName);

        // é‡ç½®é€‰ä¸­çŠ¶æ€
        state.m8.selectedLeft = null;
        state.m8.matchedCount = 0;
        state.m8.currentUnit = unitName;

        const leftContainer = document.getElementById("m8-texts");
        const rightContainer = document.getElementById("m8-options");
        leftContainer.innerHTML = "";
        rightContainer.innerHTML = "";

        if (unitData.length === 0) {
          leftContainer.innerHTML =
            "<div style='color:#999; padding:20px'>æš‚æ— è¯¥å•å…ƒæ•°æ®</div>";
          return;
        }

        // 3. æ¸²æŸ“å·¦ä¾§ (Paragraphs)
        unitData.forEach((item) => {
          const div = document.createElement("div");
          div.className = "match-item";
          div.dataset.id = item.id;

          // --- ä¿®å¤æ˜¾ç¤ºä¹±çš„é—®é¢˜ ---
          // æ™ºèƒ½æå–æ•°å­—ï¼šå¦‚æœæ˜¯ u2-1 å– 1ï¼Œå¦‚æœæ˜¯ 1 ç›´æ¥ç”¨ 1
          let displayNum = item.id;
          if (typeof item.id === "string" && item.id.includes("-")) {
            displayNum = item.id.split("-")[1];
          }

          // ä½¿ç”¨æ›´åŠ æ•´é½çš„ HTML ç»“æ„
          div.innerHTML = `
            <div style="
                font-weight:bold; 
                color:var(--primary); 
                border-bottom:1px solid #eee; 
                padding-bottom:5px; 
                margin-bottom:8px;
                font-size: 1em;">
                Paragraph ${displayNum}
            </div>
            <div style="font-size: 0.95em; color:#34495e; line-height:1.4;">
                ${item.text}
            </div>
          `;

          div.onclick = () => handleLeftClick(div, item.id);
          leftContainer.appendChild(div);
        });

        // 4. æ¸²æŸ“å³ä¾§ (Options) - éšæœºæ‰“ä¹±
        const shuffledOptions = [...unitData].sort(() => 0.5 - Math.random());
        shuffledOptions.forEach((item) => {
          const div = document.createElement("div");
          div.className = "match-item";
          div.dataset.matchId = item.id;

          // å³ä¾§ä¹Ÿç¨å¾®ç¾åŒ–ä¸€ä¸‹ï¼Œå±…ä¸­æ˜¾ç¤º
          div.innerHTML = `
            <div style="display:flex; align-items:center; justify-content:center; height:100%;">
                ${item.answer}
            </div>
          `;

          div.onclick = () => handleRightClick(div, item.id);
          rightContainer.appendChild(div);
        });

        state.m8.loaded = true;
      }

      // --- è¡¥å…¨ç¼ºå¤±çš„ç‚¹å‡»é€»è¾‘ ---

      function handleLeftClick(elem, id) {
        if (elem.classList.contains("matched")) return;

        // æ¸…é™¤å·¦ä¾§å…¶ä»–é€‰ä¸­
        document
          .querySelectorAll("#m8-texts .match-item")
          .forEach((d) => d.classList.remove("selected"));

        // é€‰ä¸­å½“å‰
        elem.classList.add("selected");
        state.m8.selectedLeft = { id: id, element: elem };
      }

      function handleRightClick(elem, targetId) {
        if (elem.classList.contains("matched")) return;

        if (!state.m8.selectedLeft) {
          alert("è¯·å…ˆç‚¹å‡»å·¦ä¾§çš„æ®µè½ (Please select a paragraph first)");
          return;
        }

        const leftId = state.m8.selectedLeft.id;
        const leftElem = state.m8.selectedLeft.element;
        // æ³¨æ„ï¼šHTML dataset é‡Œçš„ matchId æ˜¯å­—ç¬¦ä¸²ï¼Œå¦‚æœæ•°æ®æºæ˜¯æ•°å­—éœ€è¦æ³¨æ„è½¬æ¢ï¼Œè¿™é‡Œç»Ÿä¸€æŒ‰å­—ç¬¦ä¸²å¯¹æ¯”æ›´å®‰å…¨
        const rightId = elem.dataset.matchId;

        // å¯¹æ¯” ID (è½¬ä¸ºå­—ç¬¦ä¸²å¯¹æ¯”ä»¥é˜²ä¸‡ä¸€)
        if (String(leftId) === String(rightId)) {
          // åŒ¹é…æˆåŠŸ
          leftElem.classList.remove("selected");
          leftElem.classList.add("matched");
          elem.classList.add("matched");

          // å¯ä»¥åœ¨è¿™é‡Œæ”¹å˜å·¦ä¾§æ ·å¼ï¼Œæ¯”å¦‚å˜æˆç»¿è‰²ï¼Œè¡¨ç¤ºå·²å®Œæˆ
          leftElem.style.borderColor = "#2ecc71";
          leftElem.querySelector("div").style.color = "#2ecc71"; // è®©æ ‡é¢˜å˜ç»¿

          state.m8.selectedLeft = null;
          state.m8.matchedCount++;

          // æ£€æŸ¥æ˜¯å¦å…¨éƒ¨å®Œæˆ
          const totalInUnit = document.querySelectorAll(
            "#m8-texts .match-item"
          ).length;
          if (state.m8.matchedCount === totalInUnit) {
            setTimeout(() => alert("ğŸ‰ å¤ªæ£’äº†ï¼æœ¬å•å…ƒå…¨éƒ¨åŒ¹é…å®Œæˆï¼"), 300);
          }
        } else {
          // åŒ¹é…é”™è¯¯
          elem.classList.add("error");
          setTimeout(() => elem.classList.remove("error"), 500);
        }
      }
    </script>
  </body>
</html>
